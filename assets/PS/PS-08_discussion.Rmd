
---
title: "Problem Set 08"
author: "WRITE YOUR NAME HERE"
date: "Due Friday, November 11, 2016"
output:
  html_document:
    df_print: kable
---


```{r, message=FALSE, echo=TRUE}
library(ggplot2)
library(dplyr)
library(mosaic)
library(knitr)
set.seed(76)
```



## Question 1:

We will be conducting the study from Lec21 on Friday November 4th on whether or
not wearing shoes while sleeping causes people to wake up with headaches.

#### a)

Dr. Quack goes through the medical files for 1000 of their patients and obtains 
variables:

* `shoes_on`: whether or not the patient slept with their shoes on
* `headache`: whether or not the patient woke up with a headache

where in both cases `0` indicates false and `1` indicates true. Dr. Quack 
presents their findings in a data frame `study_data_1` which is loaded from the
web below. Questions:

1. Who had a higher headache rate: students who slept with their shoes on or those
who didn't? Is this difference significant?
1. Can you prove or disprove the claim that sleeping with shoes on causes people
to wake up with a headache with the information below? Why or why not?

```{r, echo=TRUE, message=FALSE, warning=FALSE}
study_data_1 <- readr::read_csv("https://rudeboybert.github.io/MATH116/assets/PS/study_data_1.csv")
```


#### Solution to a)

We want to evaluate the effect of a treatment on some outcome.

1. **Treatment**: sleeping with shoes one
1. **Outcome variable**: waking up with a headache
1. **Treatment group**: those students who slept with shoes on
1. **Control group**: those students who didn't
1. **Comparison**: proportion of students who woke up with a headache between the two groups
1. **Treatment/controls group assignment**: NOT at random; students **self-selected** 
themselves (probably via alcohol), and thus we have an observational study


```{r, echo=TRUE, message=FALSE, warning=FALSE}
study_data_1 %>% 
  group_by(shoes_on) %>% 
  summarise(prop_headache=mean(headache))
```

While it does appear those with shoes on had a higher headache rate (79.2% vs
34.2% for a difference of 45%), this is **observational data**, in other words
we didn't assign the treatmeant at random, so we can't conclude that wearing
shoes **causes** people to wake with headaches.


******


#### b)

Take your code for part a), but change it so that retroactively we had data from
a **randomized experiment**. Questions:

* Who now had a higher headache rate: students who slept with their shoes on or those
who didn't? Is this difference significant?
* Can you prove or disprove the claim that sleeping with shoes on causes people
to wake up with a headache with the information below? Why or why not?


#### Solution to b)

To have a **randomized experiment**, we must assign the treatment at random. In 
this case since the treatment is shoes on, we need a way to assign shoes vs no
shoes at random. 

We can do this by using `shuffle()`! This is akin to creeping into students' 
dorm rooms, switching around the shoes at random (i.e. **not let the students 
self-select** themselves into the treatement vs control groups) and then
observing who got a headaches.

```{r, echo=TRUE, message=FALSE}
study_data_1 %>% 
  mutate(shoes_on=shuffle(shoes_on)) %>% 
  group_by(shoes_on) %>% 
  summarise(prop_headache=mean(headache))
```

There is a difference of about 3.2% now, much less than 45% earlier! Notes:

* Is this difference **statistically significant**? We'll see shortly.
* Why did we `shuffle()` the shoes? To keep the number of students with shoes on the same.
* **Key point**: Say we are hypothesis testing with $H_0$: shoes have no effect
on waking up with a headache. `shuffle()` is akin to assuming $H_0$ is true: **it doesn't
matter that we're switching shoes around if we assume they have no effect!**


******



#### c)

Now say you also have access to information as to whether or not the patient got
wasted the night before. Generate a table that compares headache rates for those
patients who slept with shoes on versus those who didn't **controlling** for 
whether or not they got wasted, in other words, taking into account whether or
not they got wasted.

```{r, echo=TRUE, message=FALSE, warning=TRUE}
study_data_2 <- readr::read_csv("https://rudeboybert.github.io/MATH116/assets/PS/study_data_2.csv")
```




#### Solution to c)

We now have access to whether or not they were wasted, i.e. we can **control**
for how wasted the student was:

```{r, echo=TRUE, message=FALSE}
study_data_2 %>% 
  group_by(wasted, shoes_on) %>% 
  summarise(prop_headache=mean(headache))
```

**Controlling** for how wasted the student was, there doesn't not seem to be
any differences in the proportion of students who wake up with a headache:

* About 11% of non-wasted students woke up with a headache **irregardless** of whether they slept with shoes on
* About 90% of wasted students woke up with a headache **irregardless** of whether they slept with shoes on








## Question 2:

You are going to compute via simulation and not via mathematical formulas, the 
**probability distribution** of all possible sums of two die rolls: for all 
possible sums of rolling two dice (x=2, x=3, ..., x=12), we compute
Probability(sum of rolling two dice = x).

1. Write code that will simulate die rolls and manipulate the output so that
you end up with a data frame `probs` with 11 rows and 2 columns:
    + `sum`: each value of the possible sum of rolling two dice
    + `probability`: the observed probability of each value of `sum`
1. Once you've fully created it, change the `eval=FALSE` to `eval=TRUE` in the 
starting line of the code block below to have the plot get generated.
1. Note even though `sum` is a numerical variable, we'll treat it as a 
categorical variable by using the `factor()` command and using a bar chart. It 
looks cleaner this way.

#### Solution

Key point to understand:

* We first simulate sums of two die rolls. These are the possible outcomes: 2, 3, 4, ..., 11 or 12.
* We then count the number of times each outcome occurred using `n()` and not `sum()`
* We convert the counts into to proportion by dividing by the number of simulations we did: 10000


```{r, eval=TRUE}
# Write your code to create the data frame probs here:
die <- c(1:6)
two_die_rolls <- do(10000) * resample(die, size=2, replace = TRUE)

probs <- two_die_rolls %>% 
  mutate(sum=V1+V2) %>% 
  group_by(sum) %>% 
  summarise(count=n()) %>% 
  mutate(probability=count/10000)

# Suggested ggplot call. Feel free to change it:
ggplot(probs, aes(x=factor(sum), y=probability)) +
  geom_bar(stat="identity") +
  labs(x="Sum", y="Probability of Sum", title="Outcomes of Rolling Two Dice")
```




## Question 3:

Problem 3.20 on page 162 of the OpenIntro Textbook on "With and without 
replacement". For this question, find all probabilities using R's sampling 
capabilities.


#### d)

For the stadium case, answer the following questions about the components of the
"powerball" analogy:

**Atrributes of the Lottery Machine**:

* How many balls do you have? **10000**
* What are written on the balls? **Either "M" for male or "F" for female**
* Do the balls have equal probability of being picked? **Yes**


**Attributes of the Drawing**:

* How are you drawing the balls? **At random**
* How many balls do you draw? **2**
* What are you recording about each drawn ball? **What you observed**


******

#### Advanced: a) and b) from text

**Starter Code**: We define a `room` and `stadium`, both half female, but with 
populations of size `n=10` and `n=10000`. Let `1` represent a female and `0` 
represent a male, so that to count the number of females we need to only `sum()`
a series of `0`'s and `1`'s.

```{r}
room <- rep(c(1, 0), each=5)
stadium <- rep(c(1, 0), each=5000)

# Sampling with and without replacement from the room
room_sample_with_replace <- do(10000)*sample(room, size=2, replace=TRUE)
room_sample_with_replace %>% 
  mutate(num_female = V1+V2) %>% 
  group_by(num_female) %>% 
  summarise(count=n())

room_sample_without_replace <- do(10000)*sample(room, size=2, replace=FALSE)
room_sample_without_replace %>% 
  mutate(num_female = V1+V2) %>% 
  group_by(num_female) %>% 
  summarise(count=n())

# Sampling with and without replacement from the stadium
stadium_sample_with_replace <- do(10000)*sample(stadium, size=2, replace=TRUE)
stadium_sample_with_replace %>% 
  mutate(num_female = V1+V2) %>% 
  group_by(num_female) %>% 
  summarise(count=n())

stadium_sample_with_replace <- do(10000)*sample(stadium, size=2, replace=FALSE)
stadium_sample_with_replace %>% 
  mutate(num_female = V1+V2) %>% 
  group_by(num_female) %>% 
  summarise(count=n())
```

Fill in the table with the results from your simulations in the code block below

Sampling Type        | Room   | Stadium
-------------------- | -------| -------
With replacement     | 0.250  | 0.2485
Without replacement  | 0.223  | 0.2501

**Conclusion**:

* The effect of sampling with vs without replacement in the room leads to a difference of 2.7%
* The effect of sampling with vs without replacement in the stadium leads to a difference of 0.0016%


#### Advanced: c) from text

**Moral of the Story**: The larger the population, the less the difference in results between sampling
with vs without replacement matter.






